---
published: true
title: 【Flask数据库】ORM层面删除数据注意事项
category: flask_MySQL
tags:
  - python
  - flask
  - MySQL
layout: post
---
尽管MySQL默认约束类型为RESTRIC，但若不设置从表中关联列的nullable=False，那么通过sqlalchemy的ORM删除数据不会报错！！
```python
class User(Base):
    __tablename__ = 'user'
    id = Column(Integer,primary_key=True,autoincrement=True)
    username= Column(String(50),nullable=False)
    articles = relationship("Article",backref="tags")

    def __repr__(self):
        return "<Tag(title:%s)>" % self.title

class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    title= Column(String(50),nullable=False)
    uid = Column(Integer,ForeignKey("User.id"))
    author = relationship("User",backref = "articles")

    def __repr__(self):
        return "<Article(title:%s)>" % self.title

Base.metadata.drop_all()
Base.metadata.create_all()
#添加一条数据
user = User(username='zhiliao')
article = Article(title='hello world')
article.author = user
session.add(article)
session.commit()
#尽管MySQL默认约束类型为RESTRIC，但用sqlalchemy的ORM删除数据不会报错！！实际步骤为：检测到有外键关联，但发现外键类型为RESTRICT，因此先通过外键找到关联的数据，将关联的uid设置为null，之后再删除user。
user = session.query(User).first()
session.delete(user)
session.commit()
#要防止误删时RESTRICT没用，应该在创建外键时设置nullable=False。
class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    title= Column(String(50),nullable=False)
    uid = Column(Integer,ForeignKey("User.id"),nullable=False)
    author = relationship("User",backref = "articles")

```
