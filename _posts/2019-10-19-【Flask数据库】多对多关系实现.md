---
published: true
title: 【Flask数据库】多对多关系实现
category: flask_MySQL
tags:
  - python
  - flask
  - MySQL
layout: post
---
# 一、多对多关系
问题说明：一篇文章可以有多个标签，一个标签下也可以有多个文章。
解决方法：构件一张中间表，以存储他们的对应关系。
`from sqlalchemy import Table`
创建一个Table对象并在Article类或Tag类内建立relationship时传入secondary = Table对象。
即：`article_tag =Table(...)`,
`tags = relationship("Tag",backref="articles",secondary = article_tag )`
```python
from sqlalchemy import Table



article_tag = Table("article_tag",#指定表名
    #在创建表时指定用Base.metadata创建
    Base.metadata,
    #创建名为"article_id"的列，一头连接article.id
    Column("article_id",Integer,ForeignKey("article.id"),primary_key = True),
    #创建名为"tag_id"的列，一头连接tag.id，并且也设置为主键，从而与article_id组成复合主键，复合主键会组合查重，如1-1与1-1重复，而1-1与1-2不重复。这就避免了数据重复问题。
    Column("tag_id",Integer,ForeignKey("tag.id"),primary_key = True)
)


class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    title = Column(String(50),nullable=False)
    #tags = relationship("tag",backref="articles",secondary = article_tag )

    def __repr__(self):
        return "<Article(title:%s)>" % self.title

class Tag(Base):
    __tablename__ = 'tag'
    id = Column(Integer,primary_key=True,autoincrement=True)
    name= Column(String(50),nullable=False)
    articles = relationship("Article",backref="tags",secondary = article_tag)

    def __repr__(self):
        return "<Tag(title:%s)>" % self.title

#添加数据
article1 = Article(title="title1")
article2 = Article(title="title2")

tag1 = Tag(name="tag1")
tag2 = Tag(name="tag2")

article1.tags.append(tag1)
article1.tags.append(tag2)

article2.tags.append(tag1)
article2.tags.append(tag2)

session.add_all(article1,article2)
session.commit()

#查询数据
article = session.query(Article).first()
print(article.tags)
```
