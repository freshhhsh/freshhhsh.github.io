---
published: true
title: 【Flask数据库】数据查询懒加载技术
category: flask_MySQL
tags:
  - python
  - flask
  - MySQL
layout: post
---
# 懒加载
在一对多，或者多对多的时候，如果想要获取多的这一部分的数据的时候，往往能通过一个属性就可以全部获取了。比如有一个作者，想要或者这个作者的所有文章，那么可以通过user.articles就可以获取所有的。但有时候我们不想获取所有的数据，比如只想获取这个作者今天发表的文章，那么这时候我们可以给relationship传递一个lazy='dynamic'，以后通过user.articles获取到的就不是一个列表，而是一个AppendQuery对象了。这样就可以对这个对象再进行一层过滤和排序等操作。
******
### 1、lazy可用选项
#### 1）'select'：默认选项，如果不使用访问对象的某些属性，则不会提取那些属性，如user.articles，在不使用时就不会访问，一旦使用则提取该属性的全部内容并组装成一个列表。
#### 2）'dynamic'：访问'user.articles'不是返回一个列表，而是`AppenderQuery`对象。
#### 3）`immediate`：立刻提取访问对象并提取它的相关属性。
```python
class User(Base):
    __tablename__ = 'user'
    id = Column(Integer,primary_key = True,autoincrement = True)
    username = Column(String(50),nullable = False)

class Article(Base):
    __tablename__ = article
    id = Column(Integer,primary_key = True,autoincrement = True)
    title = Column(String(50),nullable = False)
    create_time = Column(DateTime,default = datetime.now)
    uid = Column(Integer,ForeignKey("user.id"))

    autho = relationship("User",backref=backref("articles",lazy = 'dynamic')

user  = session.query(User).first()
#因为使用了lazy='dynamic'，所以user为AppenderQuery对象，可继续追加数据进去。
article = Article(title="title 101")
user.articles.append(article)
session.commit()
```
